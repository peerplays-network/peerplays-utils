stages:
  - build
  #- triggers

# peerplays-qa-trigger:
#   stage: triggers
#   trigger:
#     include: peerplays-qa-environment/.gitlab-ci.yml
#   strategy: depend
#   # rules:
#   #   - changes:
#   #       - peerplays-qa-environment/*


build_peerplays:
  stage: build
  image: docker:latest
  services:
    - docker:19.03.12-dind
  before_script:
    - printenv
    - docker info
    - docker login -u "$CI_REGISTRY_USER" -p "$CI_REGISTRY_PASSWORD" $CI_REGISTRY
  # Default branch leaves tag empty (= latest tag)
  # All other branches are tagged with the escaped branch name (commit ref slug)
  script:
    - docker build -f peerplays-qa-environment/faucet/Dockerfile -t "$CI_REGISTRY_IMAGE/faucet-for-peerplays:test" .
    - docker push "$CI_REGISTRY_IMAGE/faucet-for-peerplays:test"
  # Run this job in a branch where a Dockerfile exists
  when: manual
  tags:
    - docker


# build_bitcoin:
#   stage: build

# build_faucet:
#   stage: build

# build_hive:
#   stage: build
